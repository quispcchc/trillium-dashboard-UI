<div class="tabs-container">
  <div class="tabs">
    <button [class.active]="selectedTab === 'board'" (click)="selectTab('board')">Board</button>
    <button [class.active]="selectedTab === 'qca'" (click)="selectTab('qca')">QCA</button>
    <button [class.active]="selectedTab === 'management'" (click)="selectTab('management')">Management</button>
    <button [class.active]="selectedTab === 'dataentry'" (click)="selectTab('dataentry')">Data entry</button>
    <button [class.active]="selectedTab === 'admin'" (click)="selectTab('admin')">Admin</button>
  </div>

  <div class="tab-content">
    <!-- Board Tab Content -->
    <ng-container *ngIf="selectedTab === 'board'">
      <iframe title="Governance Dashboard" width="100%" height="100%"
        src="https://app.powerbi.com/view?r=eyJrIjoiZDM0YzYzNDYtNzZiNC00MmU0LWJlMmQtYjQ2MDNhYmNhN2E2IiwidCI6IjRlN2M3ZjFiLTIyMTItNGM0NC1hMjIxLTI3MjQ0NzQ4NzIwNSJ9"
        frameborder="0" allowFullScreen="true"></iframe>
    </ng-container>
    <!-- QCA Tab Content -->
    <ng-container *ngIf="selectedTab === 'qca'">
      <p>QCA content goes here.</p>
    </ng-container>
    <!-- Management Tab Content -->
    <ng-container *ngIf="selectedTab === 'management'">
      <p>Management content goes here.</p>
    </ng-container>
    <!-- Data Entry Tab Content -->
    <ng-container *ngIf="selectedTab === 'dataentry'">
      <div class="admin-container">
        <nav class="admin-sidebar">
          <ul>
            <li [class.active]="currentFormAction === 'accreditation'" (click)="setCurrentForm('accreditation')">
              Accreditation Form</li>
            <li [class.active]="currentFormAction === 'form2'" (click)="setCurrentForm('form2')">Form2</li>
            <li [class.active]="currentFormAction === 'form3'" (click)="setCurrentForm('form3')">Form3</li>
            <li [class.active]="currentFormAction === 'form4'" (click)="setCurrentForm('form4')">Form4</li>
            <li [class.active]="currentFormAction === 'form5'" (click)="setCurrentForm('form5')">Form5</li>
          </ul>
        </nav>
        <div class="admin-content">
          <div *ngIf="currentFormAction === 'accreditation'">
            <iframe
              src="https://forms.office.com/Pages/ResponsePage.aspx?id=G398ThIiREyiISckR0hyBaHnWO33bJxJoFfw7dIgHARUN1pWMUNBVEg3UFVZMllDVkpMOE9DRDhBNC4u"
              width="100%" height="100%" frameborder="0" scrolling="auto"></iframe>
          </div>
          <div *ngIf="currentFormAction === 'form2'">
            <p>form2 content goes here.</p>
          </div>
          <div *ngIf="currentFormAction === 'form3'">
            <p>form3 content goes here.</p>
          </div>
          <div *ngIf="currentFormAction === 'form4'">
            <p>form4 content goes here.</p>
          </div>
          <div *ngIf="currentFormAction === 'form5'">
            <p>form5 content goes here.</p>
          </div>
        </div>
      </div>
    </ng-container>
    <!-- Admin Tab Content -->
    <ng-container *ngIf="selectedTab === 'admin'">
      <app-confirmation-modal *ngIf="isDeleteModalOpen" [message]="'Are you sure you want to delete this user?'"
        (confirmed)="onDeleteConfirmed($event)">
      </app-confirmation-modal>

      <div class="admin-container">
        <nav class="admin-sidebar">
          <ul>
            <li [class.active]="currentAdminAction === 'manageUsers'" (click)="manageUsers()">Manage Users</li>
            <li [class.active]="currentAdminAction === 'auditLogs'" (click)="auditLogs()">Audit Logs</li>
          </ul>
        </nav>
        <div class="admin-content">
          <div *ngIf="loading">Loading users...</div>

          <div *ngIf="currentAdminAction === 'manageUsers'">
            <button class="create-user-button" (click)="openModal()">Create User</button>
            <div class="search-container">
              <input type="text" placeholder="Search Users by Name or Email" [(ngModel)]="searchTerm"
                (input)="filterUsers()" />
              <span class="search-icon"><i class="fas fa-search"></i></span>
            </div>
            <div class="table-container" *ngIf="!loading && filteredUsers.length > 0">
              <div class="table-header">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th (click)="sort('name')">Name</th>
                      <th (click)="sort('email')">Email</th>
                      <th (click)="sort('department')">Department</th>
                      <th (click)="sort('title')">Job Title</th>
                      <th></th>
                    </tr>
                  </thead>
                </table>
              </div>
              <div class="table-body">
                <table>
                  <tbody>
                    <tr *ngFor="let user of filteredUsers">
                      <td>{{ user.user_id }}</td>
                      <td>{{ user.first_name }} {{ user.last_name }}</td>
                      <td>{{ user.mail }}</td>
                      <td>{{ user.department }}</td>
                      <td>{{ user.job_title }}</td>
                      <td>
                        <span (click)="updateUser(user)" title="Update User"
                          style="cursor: pointer; margin-right: 10px;">
                          <img src="edit-icon.png" alt="Update" style="width:20px;" />
                        </span>
                        <span (click)="confirmDelete(user.user_id)" title="Delete User" style="cursor: pointer;">
                          <img src="delete-icon.png" alt="Delete" style="width:25px;" />
                        </span>
                        
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div *ngIf="!loading && filteredUsers.length === 0">No users found.</div>
          </div>

          <div *ngIf="currentAdminAction === 'auditLogs'">
            <p>Audit logs content goes here.</p>
          </div>

          <div class="modal" *ngIf="isModalOpen">
            <div class="modal-content">
              <span class="close" (click)="closeModal()">&times;</span>
              <div class="modal-header">
                <h2>Create User</h2>
              </div>
              <div class="modal-body">
                <form (ngSubmit)="createUser()">
                  <div class="form-group">
                    <label for="firstName">First Name</label>
                    <input type="text" id="firstName" [(ngModel)]="newUser.firstName"
                      (ngModelChange)="isUserFormValid()" name="firstName" required />
                  </div>
                  <div class="form-group">
                    <label for="lastName">Last Name</label>
                    <input type="text" id="lastName" [(ngModel)]="newUser.lastName" (ngModelChange)="isUserFormValid()"
                      name="lastName" required />
                  </div>
                  <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" [(ngModel)]="newUser.email" (ngModelChange)="isUserFormValid()"
                      name="email" required />
                  </div>
                  <div class="form-group">
                    <label for="department">Department</label>
                    <input type="text" id="department" [(ngModel)]="newUser.department"
                      (ngModelChange)="isUserFormValid()" name="department" required />
                  </div>
                  <div class="form-group">
                    <label for="department">Job Title</label>
                    <input type="text" id="title" [(ngModel)]="newUser.jobTitle" (ngModelChange)="isUserFormValid()"
                      name="jobTitle" required />
                  </div>
                  <div class="form-group">
                    <label for="password">Password</label>
                    <input type="text" id="password" [(ngModel)]="newUser.password" (ngModelChange)="isUserFormValid()"
                      name="password" required />
                  </div>
                </form>
              </div>

              <div class="modal-footer">
                <button class="create-button" (click)="createUser()" [disabled]="!isUserFormValid()">Create</button>
                <button class="cancel-button" (click)="closeModal()">Cancel</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="notification" *ngIf="notificationService.getMessage()">
        {{ notificationService.getMessage() }}
      </div>
    </ng-container>
  </div>
</div>
